<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Color Analyzer</title>
    <style>
        body {
            font-family: monospace;
            font-variant-ligatures: none;
            max-width: 60vw;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            font-size: 2em;
            background-color: #111;
            color: #ddd;
        }

        #drop-area {
            border: 3px dashed #555;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            cursor: pointer;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #222;
        }

        #drop-area.highlight {
            border-color: #ddd;
            background-color: #333;
        }

        #file-input {
            display: none;
        }

        #pixel-colors {
            margin-top: 20px;
            text-align: left;
            background-color: #222;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .color-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .color-box {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            border: 1px solid #444;
        }

        .color-item:hover {
            background-color: #333;
        }

        #loading {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #222;
            z-index: 10;
            border-radius: 7px;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #444;
            border-top: 4px solid #ddd;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        h2 {
            margin-top: 0;
        }
    </style>
</head>

<body>
    <h1>Pixel Color Analyzer</h1>

    <div id="drop-area">
        <div id="loading">
            <div class="spinner"></div>
        </div>
        <p>Drag & drop an image here</p>
        <p>Or press Ctrl+V anywhere to paste an image</p>
        <p><u>Click to upload</u></p>
        <input type="file" id="file-input" accept="image/*">
    </div>

    <div id="pixel-colors"></div>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const pixelColorsDiv = document.getElementById('pixel-colors');
        const loadingElement = document.getElementById('loading');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        dropArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', function (e) {
            if (fileInput.files.length) {
                handleImage(fileInput.files[0]);
            }
        });

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            if (!loadingElement.style.display || loadingElement.style.display === 'none') {
                dropArea.classList.add('highlight');
            }
        }

        function unhighlight() {
            dropArea.classList.remove('highlight');
        }

        dropArea.addEventListener('drop', function (e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            if (file && file.type.match('image.*')) {
                handleImage(file);
            }
        });

        document.addEventListener('paste', function (e) {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const blob = items[i].getAsFile();
                    handleImage(blob);
                    break;
                }
            }
        });

        function handleImage(file) {
            showLoading();
            const reader = new FileReader();
            reader.onload = function (event) {
                loadImage(event.target.result);
            };
            reader.readAsDataURL(file);
        }

        function showLoading() {
            loadingElement.style.display = 'flex';
            pixelColorsDiv.style.display = 'none';
            pixelColorsDiv.innerHTML = '';
            dropArea.classList.remove('highlight');
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        function loadImage(imageSrc) {
            const img = new Image();
            img.onload = function () {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                setTimeout(() => {
                    analyzePixels();
                    hideLoading();
                }, 50);
            };
            img.onerror = hideLoading;
            img.src = imageSrc;
        }

        function analyzePixels() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            const colorCounts = {};

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const a = data[i + 3];

                if (a === 0) continue;

                const hex = rgbToHex(r, g, b);

                if (colorCounts[hex]) {
                    colorCounts[hex]++;
                } else {
                    colorCounts[hex] = 1;
                }
            }

            const sortedColors = Object.entries(colorCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 1024);

            displayResults(sortedColors);
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function displayResults(colorData) {
            if (colorData.length > 0) {
                pixelColorsDiv.innerHTML = '<h2>Color Statistics:</h2>';

                colorData.forEach(([hex, count]) => {
                    const colorItem = document.createElement('div');
                    colorItem.className = 'color-item';
                    colorItem.title = 'Click to copy ' + hex;

                    colorItem.innerHTML = `
                        <div class="color-box" style="background-color: ${hex}"></div>
                        <span>${hex}: ${count}</span>
                    `;

                    colorItem.addEventListener('click', function () {
                        navigator.clipboard.writeText(hex).then(() => {
                            const originalText = colorItem.querySelector('span').textContent;
                            colorItem.querySelector('span').textContent = 'Copied!';
                            setTimeout(() => {
                                colorItem.querySelector('span').textContent = originalText;
                            }, 1000);
                        });
                    });

                    pixelColorsDiv.appendChild(colorItem);
                });

                pixelColorsDiv.style.display = 'block';
            }
        }
    </script>
</body>

</html>
